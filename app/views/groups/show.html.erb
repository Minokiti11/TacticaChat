<meta name="turbolinks-visit-control" content="reload">
<div class='container px-5 px-sm-0'>
  <div class='row'>
    <div class='col-md-8 offset-md-1'>
      <h2 style='margin-top: 30px;'><%= @group.name %></h2>
        <td>
          <div class="panel-group">
            <div class="panel panel-default">
              <div class="panel-heading">
                <a data-toggle="collapse" href="#collapse2">
                  <%= image_tag 'group.png', size: "23x23" %><%= @group.users.size %></br>
                </a>
              </div>
              <div id="collapse2" class="panel-collapse collapse">
                <ul class="list-group">
                  <% @group.users.each do |user| %>
                    <li class="list-group-item"><%= user.username %></li>
                  <% end %>
                </ul>
              </div>
            </div>
          </div>
        </td>

        <td>
          <% if @group.owner_id == current_user.id %>
            <%= link_to 'Edit', edit_group_path(@group), class: "btn btn-success", style: "margin-top: 30px;"%>
            <%= button_to '招待リンクを発行', generate_invite_link_group_path(@group), method: :post, class: "btn btn-primary rounded btn-sm", style: "font-size: calc(0.53rem + 0.5vw); margin-top: 10px;" %>
            <%# <%= link_to 'ChatPage', group_chat_path(@group), "data-turbo": false, class: "btn btn-success", style: "margin-top: 10px;"%>

            <%= link_to '試合 映像', group_video_path(@group), "data-turbo": false, class: "btn btn-success", style: "margin-top: 10px;" %>
            <%= button_to 'このグループから退会', group_path(@group), method: :delete, class: "btn btn-danger", style: "margin-top: 15px;"%>
            <div id="modal-open-btn">
              <%= button_to 'このグループを削除', group_all_destroy_path(@group), method: :delete, class: "btn btn-danger", style: "margin-top: 10px;"%>
            </div>
            <div id="overlay">
              <div id="modalWindow">
                <div class="modal-message-box">
                  <div>確認</div>
                  <div>本当に削除しますか？</div>
                </div>
                <button id="modal-close-btn">キャンセル</button>
                <button id="modal-close-btn">削除する</button>
              </div>
            </div>
          <% elsif @group.users.include?(current_user) %>
            <%= link_to 'ChatPage', group_chat_path(@group), "data-turbo": false, class: "btn btn-success", style: "margin-top: 15px;" %>
            <%= link_to '試合 映像', group_video_path(@group), class: "btn btn-success", style: "margin-top: 15px;" %>
            <%= button_to '招待リンクを発行', generate_invite_link_group_path(@group), method: :post, class: "btn btn-primary rounded btn-sm", style: "font-size: calc(0.53rem + 0.5vw); margin-top: 15px;" %>
            <%= button_to 'このグループから退会', group_path(@group), method: :delete, class: "btn btn-danger", style: "margin-top: 15px;"%>
          <% end %>
        </td>
        <td>
          <div class="row" style="margin-top: 30px;">
            <h3>直近の動画</h3>
            <% @videos.last(3).each do |video| %>
              <div class="col">
                <%= link_to video_path(video), "data-turbo": false, class: "card mb-3", style: "text-decoration: none; color: black; margin: 20px;" do %>
                  <% s3 = Aws::S3::Resource.new(
                          region: "ap-northeast-1",
                          credentials: Aws::Credentials.new(
                            Rails.application.credentials.dig(:aws, :access_key_id),
                            Rails.application.credentials.dig(:aws, :secret_access_key)
                          )
                        )
                    signer = Aws::S3::Presigner.new(client: s3.client)
                    presigned_url = signer.presigned_url(:get_object, bucket: Rails.application.credentials.dig(:aws, :bucket), key: "output/thumbnail/#{video.video.filename.base}/#{video.video.filename.base}_thumbnail.0000000.jpg", expires_in: 60) %>
                  <%= image_tag presigned_url, class: "card-img-top" %>

                  <div class="card-body">
                    <h5 class="card-title"><%= video.title %></h5>
                    <p class="card-text"><%= truncate(video.introduction, length: 100) %></p>
                    <div class="d-flex justify-content-between align-items-center">
                      <small class="text-muted"><%= time_ago_in_words(video.created_at) %> ago</small>
                    </div>
                  </div>
                <% end %>

              </div>
            <% end %>
          </div> 
        </td>

    </div>
  </div>
</div>